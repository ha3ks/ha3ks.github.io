<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Main Dashboard</title>
<link rel="icon" href="/assets/favicon.ico" type="image/x-icon">
<link rel="apple-touch-icon" href="/assets/favicon.png">
<link rel="stylesheet" href="style.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<!-- Top Navigation -->
<nav class="top-nav">
    <div class="nav-title">Ha3ks.com Main Dashboard</div>

    <div class="nav-links">
        <a href="/">üè† Home</a>
        <a href="/archive">üìù Blog</a>
    </div>
</nav>

<!-- Dashboard Grid -->
<div class="dashboard">


  <div class="panel text-panel about-panel">
  <div class="panel-title">About Me</div>
  <div class="about-content">
    <img src="/assets/profile.jpg" alt="Profile Picture" class="profile-pic">
    <p>
      Hello! I'm Dan.<br> 
      Welcome to my Grafana Inspired personal website.<br><br>
      This panel serves as a simple ‚ÄúAbout Me‚Äù section for this site.<br>
      If you want to know more, please <a href="/about/">click me!</a>
    </p>
  </div>
</div>


  <!-- Stat Panels -->
  <div class="panel stat green">
    <div class="panel-title">Total Posts</div>
    <div class="stat-value" id="totalPosts">0</div>
    <div class="stat-footer">Updated just now</div>
  </div>

  <div class="panel stat yellow">
    <div class="panel-title">Categories</div>
    <div class="stat-value" id="categoryCount">0</div>
    <div class="stat-footer">Unique tags</div>
  </div>

  <!-- Donut Chart Panel -->
  <div class="panel chart">
    <div class="panel-title">Posts by Tag</div>
    <canvas id="donutChart"></canvas>
  </div>

  <div class="panel stat red">
    <div class="panel-title">GitHub Commits</div>
    <div class="stat-value" id="githubCommits">0</div>
    <div class="stat-footer">Last 7 days</div>
  </div>

  <div class="panel" id="uptime-panel">
    <div class="panel-title">Uptime</div>
    <div id="uptime">Loading...</div>
    <div class="stat-footer">(Since Last Commit)</div>
  </div>

  <!-- Blog Post List Panel -->
  <div class="panel text-panel">
    <div class="panel-title">Latest Alerts</div>
    <ul id="postsList"></ul>
  </div>

  <!-- Calendar Panel -->
  <div class="panel" id="calendar-panel">
    <div class="panel-title">Calendar</div>
    <div class="calendar" id="calendar"></div>
  </div>

</div>

<script src="script.js"></script>
</body>
</html>

<script>
async function fetchLastCommitDate() {
    const apiUrl = `https://api.github.com/repos/ha3ks/ha3ks.github.io/commits?per_page=1`; <!-- change this to your name and repo -->
    const response = await fetch(apiUrl);
    const data = await response.json();
    if (data && data[0] && data[0].commit) {
        return new Date(data[0].commit.author.date);
    }
    return new Date(); // fallback to now
}

function formatDuration(ms) {
    const totalSeconds = Math.floor(ms / 1000);
    const days = Math.floor(totalSeconds / 86400);
    const hours = Math.floor((totalSeconds % 86400) / 3600);
    const minutes = Math.floor((totalSeconds % 3600) / 60);
    const seconds = totalSeconds % 60;
    return `${days}d ${hours}h ${minutes}m ${seconds}s`;
}

async function startUptimeCounter() {
    const lastCommitDate = await fetchLastCommitDate();
    const uptimeEl = document.getElementById("uptime");

    function update() {
        const now = new Date();
        const diff = now - lastCommitDate;
        uptimeEl.textContent = formatDuration(diff);
    }

    update();
    setInterval(update, 1000); // update every second
}

startUptimeCounter();
</script>

<script>
const calendarEl = document.getElementById("calendar");
if (calendarEl) {
    const today = new Date();
    const year = today.getFullYear();
    const month = today.getMonth();

    const firstDay = new Date(year, month, 1);
    const lastDay = new Date(year, month + 1, 0);
    const numDays = lastDay.getDate();

    // Add blank days for weekday offset
    const firstWeekday = firstDay.getDay(); // 0 = Sunday
    for (let i = 0; i < firstWeekday; i++) {
        const empty = document.createElement("div");
        calendarEl.appendChild(empty);
    }

    // Add actual days
    for (let day = 1; day <= numDays; day++) {
        const dayEl = document.createElement("div");
        dayEl.className = "calendar-day";

        // Mark today
        if (day === today.getDate()) dayEl.classList.add("today");

        // Example: mark posts days
        const postDates = [
            "2025-11-01",
            "2025-08-28",
            "2025-07-12",
        ]; // update with your blog post dates
        const dayString = `${year}-${String(month + 1).padStart(2,'0')}-${String(day).padStart(2,'0')}`;
        if (postDates.includes(dayString)) dayEl.classList.add("posted");

        dayEl.textContent = day;
        calendarEl.appendChild(dayEl);
    }
}
</script>
